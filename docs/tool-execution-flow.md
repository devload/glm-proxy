# CLAUDE CODE Tool Execution ë°ì´í„° íë¦„ ìƒì„¸ ë¶„ì„

## í•µì‹¬ ì§ˆë¬¸: "ì‘ë‹µì— ë³´ì´ëŠ” Write, Bash ë¡œê·¸ë“¤ë„ ë§¤ë²ˆ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ”ê°€?"

**ë‹µ:** ë„¤, **ì „ë¶€ ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤!**

ì´ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤: ì‚¬ìš©ìê°€ ë³´ëŠ” ì œ ì‘ë‹µì— ìˆëŠ” `Write`, `Bash` ê°™ì€ íˆ´ ì‚¬ìš© ë¡œê·¸ë“¤ì€ **ì‹¤ì œë¡œëŠ” Request Bodyì— í¬í•¨ë˜ì–´ API ì„œë²„ë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°**ì…ë‹ˆë‹¤.

---

## ì „ì²´ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. CLAUDE CODE ë‚´ë¶€ì—ì„œ ë°œìƒ                               â”‚
â”‚                                                             â”‚
â”‚  âœï¸ Write ë„êµ¬ ì‚¬ìš© â†’ ë¡œê·¸ ìƒì„±                            â”‚
â”‚  âš™ï¸ Bash ë„êµ¬ ì‚¬ìš© â†’ ë¡œê·¸ ìƒì„±                             â”‚
â”‚  ğŸ“Š Task ë„êµ¬ ì‚¬ìš© â†’ ë¡œê·¸ ìƒì„±                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ë©”ì‹œì§€ ì»¨í…ì¸  êµ¬ì„± (messages[].content[])             â”‚
â”‚                                                             â”‚
â”‚  {                                                          â”‚
â”‚    "role": "assistant",                                     â”‚
â”‚    "content": [                                             â”‚
â”‚      {"type": "text", "text": "ì‚¬ìš©ì ë‹µë³€"},             â”‚
â”‚      {"type": "thinking", "thinking": "..."},              â”‚
â”‚      {"type": "tool_use", "id": "call_xxx",               â”‚
â”‚       "name": "Write", "input": {...}}                    â”‚
â”‚    ]                                                        â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. API ì„œë²„ë¡œ ì „ì†¡ (Request Body)                        â”‚
â”‚                                                             â”‚
â”‚  POST /v1/messages                                          â”‚
â”‚  Body: {                                                    â”‚
â”‚    "model": "claude-sonnet-4-5-20250929",                  â”‚
â”‚    "messages": [                                            â”‚
â”‚      {role: "user", content: [...]},                       â”‚
â”‚      {                                                      â”‚
â”‚        "role": "assistant",                                 â”‚
â”‚        "content": [                                         â”‚
â”‚          {"type": "tool_use", ...},  â† ì´ê²ƒë„ ì „ì†¡ë¨!    â”‚
â”‚          {"type": "tool_use", ...}   â† ì´ê²ƒë„ ì „ì†¡ë¨!    â”‚
â”‚        ]                                                     â”‚
â”‚      }                                                       â”‚
â”‚    ]                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì‹¤ì œ ë¡œê·¸ ë¶„ì„

### ì˜ˆì‹œ 1: Bash ë„êµ¬ ì‚¬ìš©ì´ í¬í•¨ëœ Request

**ì‹¤ì œ í”„ë¡ì‹œ ì„œë²„ ë¡œê·¸:**
```json
{
  "model": "claude-sonnet-4-5-20250929",
  "messages": [
    {
      "role": "user",
      "content": [
        {"type": "text", "text": "glmì„ CLAUDE CODEì— ì„¸íŒ…í•˜ëŠ”ê±° ë³´ë‹ˆê¹Œ..."}
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "thinking",
          "thinking": "ì‚¬ìš©ìê°€ CLAUDE CODEì˜ CONFIGë¥¼ ìˆ˜ì •í•˜ì—¬ ì„œë²„ URLì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë¬»ê³  ìˆìŠµë‹ˆë‹¤...",
          "signature": "6048a5cd36054edabd00b80b"
        },
        {
          "type": "text",
          "text": "CLAUDE CODEì˜ ì„¤ì • íŒŒì¼ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤."
        },
        {
          "type": "tool_use",
          "id": "call_2ae5379029614977b1ca7bfa",
          "name": "Bash",
          "input": {
            "command": "ls -la ~/.claude/",
            "description": "List Claude config directory contents"
          }
        },
        {
          "type": "tool_use",
          "id": "call_13f0a23ab0ef4179bb8f1963",
          "name": "Glob",
          "input": {
            "pattern": "**/.claude*",
            "path": "/Users/rohsunghyun"
          }
        },
        {
          "type": "tool_use",
          "id": "call_f1...",
          "name": "Read",
          "input": {
            "file_path": "/Users/rohsunghyun/.claude/settings.json"
          }
        }
      ]
    }
  ],
  "tools": [],
  "metadata": {
    "user_id": "user_9911a7f2..._session_c1cd8547..."
  }
}
```

**í•µì‹¬ í¬ì¸íŠ¸:**
- âœ… `type: "tool_use"` ì¸ ì»¨í…ì¸  ë¸”ë¡ë“¤ì´ **ëª¨ë‘ API ì„œë²„ë¡œ ì „ì†¡ë¨**
- âœ… ê° tool_useì—ëŠ” `id`, `name`, `input`ì´ í¬í•¨ë¨
- âœ… ì´ê²ƒì´ ì‚¬ìš©ìê°€ ì‘ë‹µì—ì„œ ë³´ëŠ” `âº Bash(...)`, `âº Read(...)`ì˜ ì‹¤ì²´

### ì˜ˆì‹œ 2: Write ë„êµ¬ ì‚¬ìš©ì´ í¬í•¨ëœ Request

```json
{
  "messages": [
    {
      "role": "assistant",
      "content": [
        {"type": "text", "text": "í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤."},
        {
          "type": "tool_use",
          "id": "call_abc123",
          "name": "Write",
          "input": {
            "file_path": "/Users/rohsunghyun/glmAlaysis/build.gradle.kts",
            "content": "import org.jetbrains.kotlin.gradle.tasks.KotlinCompile\n\nplugins {...}"
          }
        },
        {
          "type": "tool_use",
          "id": "call_def456",
          "name": "Bash",
          "input": {
            "command": "mkdir -p src/main/kotlin",
            "description": "Create Kotlin source directory"
          }
        }
      ]
    }
  ]
}
```

---

## ë°ì´í„° êµ¬ì¡° ìƒì„¸ ë¶„ì„

### Assistant Messageì˜ content ë°°ì—´ êµ¬ì¡°

```javascript
messages: [
  {
    role: "assistant",
    content: [
      // 1. í…ìŠ¤íŠ¸ ì‘ë‹µ
      {
        type: "text",
        text: "ì‚¬ìš©ìì—ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤..."
      },

      // 2. Thinking ì¶”ì  (ìˆëŠ” ê²½ìš°)
      {
        type: "thinking",
        thinking: "ë¬¸ì œë¥¼ ë¶„ì„ì¤‘...",
        signature: "abc123..."
      },

      // 3. íˆ´ ì‚¬ìš© (ì—¬ëŸ¬ ê°œ)
      {
        type: "tool_use",
        id: "call_xxx",              // ê³ ìœ  ID
        name: "Bash",                 // íˆ´ ì´ë¦„
        input: {                      // íˆ´ ì…ë ¥ íŒŒë¼ë¯¸í„°
          command: "ls -la",
          description: "List files"
        }
      },

      // 4. ë˜ ë‹¤ë¥¸ íˆ´ ì‚¬ìš©
      {
        type: "tool_use",
        id: "call_yyy",
        name: "Write",
        input: {
          file_path: "/path/to/file.txt",
          content: "file content..."
        }
      }
    ]
  }
]
```

**ëª¨ë“  ê²ƒì´ Request Bodyì— í¬í•¨ë˜ì–´ API ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤!**

---

## íˆ´ ì‚¬ìš©ì˜ ì™„ì „í•œ ìˆ˜ëª… ì£¼ê¸°

### 1. íˆ´ ì‚¬ìš© ê²°ì • (AI ë‚´ë¶€)

```
AI: "íŒŒì¼ì„ ì½ì–´ì•¼ê² ë‹¤"
  â†’ tool_use ìƒì„±
  â†’ content ë°°ì—´ì— ì¶”ê°€
```

### 2. API ì„œë²„ë¡œ ì „ì†¡ (Request)

```json
{
  "messages": [
    {
      "role": "assistant",
      "content": [
        {
          "type": "tool_use",
          "id": "call_123",
          "name": "Read",
          "input": {"file_path": "..."}
        }
      ]
    }
  ]
}
```

**ì´ ì‹œì ì—ì„œ:**
- âœ… íˆ´ ì‚¬ìš© ì •ë³´ê°€ **API ì„œë²„ë¡œ ì „ì†¡ë¨**
- âœ… í”„ë¡ì‹œ ì„œë²„ ë¡œê·¸ì—ë„ ê¸°ë¡ë¨
- âœ… `tools=[]`ì´ì§€ë§Œ tool_use ì»¨í…ì¸ ëŠ” ë³„ë„ì„

### 3. ì‚¬ìš©ìì—ê²Œ í‘œì‹œ (CLAUDE CODE UI)

```
âº Read(/Users/rohsunghyun/.claude/settings.json)
```

ì´ê²ƒì€ ì‹¤ì œë¡œëŠ” `tool_use` ì»¨í…ì¸  ë¸”ë¡ì„ UIì—ì„œ ë³´ì—¬ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤.

### 4. íˆ´ ì‹¤í–‰ ê²°ê³¼ ìˆ˜ì‹  (ë‹¤ìŒ Request)

```json
{
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "call_123",
          "content": [
            {
              "type": "text",
              "text": "{\"enabledPlugins\": {...}...}"
            }
          ],
          "is_error": false
        }
      ]
    }
  ]
}
```

**íˆ´ ì‹¤í–‰ ê²°ê³¼ê°€ `tool_result` íƒ€ì…ìœ¼ë¡œ ë‹¤ì‹œ API ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤!**

---

## ì‹¤ì œ í”„ë¡ì‹œ ë¡œê·¸ ì˜ˆì‹œ ë¶„ì„

### Request 1: ë„êµ¬ ì‚¬ìš© ìš”ì²­

```log
2026-01-16 09:46:48.705 [reactor-http-nio-2] INFO  ProxyService - Body:
{
  "model": "claude-haiku-4-5-20251001",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "glmì„ CLAUDE CODEì— ì„¸íŒ…í•˜ëŠ”ê±° ë³´ë‹ˆê¹Œ..."
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "tool_use",
          "id": "call_2ae5379029614977b1ca7bfa",
          "name": "Bash",
          "input": {
            "command": "ls -la ~/.claude/",
            "description": "List Claude config directory contents"
          }
        },
        {
          "type": "tool_use",
          "id": "call_13f0a23ab0ef4179bb8f1963",
          "name": "Glob",
          "input": {
            "pattern": "**/.claude*",
            "path": "/Users/rohsunghyun"
          }
        }
      ]
    }
  ]
}
```

**ë¶„ì„:**
- âœ… 3ê°œì˜ tool_use ì»¨í…ì¸  ë¸”ë¡ì´ ìˆìŒ
- âœ… ëª¨ë‘ API ì„œë²„ë¡œ ì „ì†¡ë¨
- âœ… ê° tool_useì—ëŠ” id, name, inputì´ ìˆìŒ

### Request 2: íˆ´ ê²°ê³¼ ì „ì†¡

```log
2026-01-16 09:46:48.710 [reactor-http-nio-2] INFO  ProxyService - Body:
{
  "model": "claude-sonnet-4-5-20250929",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "call_2ae5379029614977b1ca7bfa",
          "content": [
            {
              "type": "text",
              "text": "total 768\ndrwxr-xr-x  23 rohsunghyun  staff     736..."
            }
          ],
          "is_error": false
        },
        {
          "type": "tool_result",
          "tool_use_id": "call_13f0a23ab0ef4179bb8f1963",
          "content": [
            {
              "type": "text",
              "text": "No files found"
            }
          ],
          "is_error": false
        }
      ]
    }
  ]
}
```

**ë¶„ì„:**
- âœ… íˆ´ ì‹¤í–‰ ê²°ê³¼ê°€ `tool_result` íƒ€ì…ìœ¼ë¡œ ì „ì†¡ë¨
- âœ… `tool_use_id`ë¡œ ì´ì „ ìš”ì²­ê³¼ ì—°ê²°
- âœ… ì‹¤í–‰ ê²°ê³¼(ì¶œë ¥)ì´ contentì— í¬í•¨ë¨

---

## ì™œ ì´ë ‡ê²Œ í•˜ëŠ”ê°€?

### 1. ì™„ì „í•œ ì»¨í…ìŠ¤íŠ¸ ìœ ì§€

API ì„œë²„ëŠ”:
- âœ… AIê°€ ì–´ë–¤ íˆ´ì„ ì‚¬ìš©í–ˆëŠ”ì§€ ì•Œì•„ì•¼ í•¨
- âœ… íˆ´ì˜ ì…ë ¥ íŒŒë¼ë¯¸í„°ë¥¼ ì•Œì•„ì•¼ í•¨
- âœ… íˆ´ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ ì•Œì•„ì•¼ í•¨
- âœ… ì „ì²´ ëŒ€í™” ë§¥ë½ì„ ìœ ì§€í•´ì•¼ í•¨

### 2. ìƒíƒœ ë¹„ì €ì¥ (Stateless) API

- API ì„œë²„ëŠ” ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ
- ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ëŠ” Requestì— í¬í•¨ë˜ì–´ ì „ì†¡ë¨
- íˆ´ ì‚¬ìš© ë‚´ì—­ë„ ì˜ˆì™¸ê°€ ì•„ë‹˜

### 3. ë¡œê¹… ë° ë””ë²„ê¹…

- ì„œë²„ëŠ” ëª¨ë“  íˆ´ ì‚¬ìš©ì„ ê¸°ë¡í•  ìˆ˜ ìˆìŒ
- ë¬¸ì œ ë°œìƒ ì‹œ ì „ì²´ íë¦„ ì¶”ì  ê°€ëŠ¥
- ì‚¬ìš©ì í™œë™ ëª¨ë‹ˆí„°ë§

---

## ë°ì´í„° í¬ê¸° ë¶„ì„

### íˆ´ ì‚¬ìš©ì´ í¬í•¨ëœ Request í¬ê¸°

```
ì˜ˆì‹œ: 5ê°œì˜ tool_useê°€ í¬í•¨ëœ Request

- ê¸°ë³¸ ë©”ì‹œì§€: ~1 KB
- ê° tool_use: ~200 bytes
- 5ê°œ tool_use: ~1 KB
- ì´ Request í¬ê¸°: ~2 KB

ì‹¤ì œ ë¡œê·¸: Content-Length: 341872
```

**í° ëŒ€í™”ì˜ ê²½ìš°:**
- íˆ´ ì‚¬ìš©ì´ 10~20ê°œë©´ ìˆ˜ì‹­ KB
- Thinking ì¶”ì ê¹Œì§€ ìˆìœ¼ë©´ 100KB ì´ìƒ
- ì´ê²ƒì´ **ë§¤ë²ˆ ì „ì†¡ë¨!**

---

## ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ ê³ ë ¤ì‚¬í•­

### íˆ´ ì‚¬ìš©ì— í¬í•¨ë˜ëŠ” ë¯¼ê° ì •ë³´

1. **file_path** (Read, Write)
   - ì‚¬ìš©ìì˜ íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡° ë…¸ì¶œ
   - í”„ë¡œì íŠ¸ ì´ë¦„, ê²½ë¡œ

2. **command** (Bash)
   - ì‚¬ìš©ìê°€ ì‹¤í–‰í•œ ëª…ë ¹ì–´
   - ì‹œìŠ¤í…œ ì •ë³´ ë…¸ì¶œ ê°€ëŠ¥

3. **content** (Write)
   - ì‘ì„±í•œ ì½”ë“œ ë‚´ìš©
   - í”„ë¼ì´ë²„í•œ ì •ë³´ í¬í•¨ ê°€ëŠ¥

4. **output** (tool_result)
   - íˆ´ ì‹¤í–‰ ê²°ê³¼
   - íŒŒì¼ ë‚´ìš©, ëª…ë ¹ ì¶œë ¥

**ëª¨ë“  ê²ƒì´ API ì„œë²„ë¡œ ì „ì†¡ë˜ê³  ë¡œê¹…ë©ë‹ˆë‹¤!**

---

## ê²°ë¡ 

### í•µì‹¬ ì´í•´

1. **ëª¨ë“  íˆ´ ì‚¬ìš©ì´ API ì„œë²„ë¡œ ì „ì†¡ë¨**
   - Write, Read, Bash, Task ë“± ëª¨ë‘
   - tool_use ì»¨í…ì¸  ë¸”ë¡ í˜•íƒœë¡œ
   - ì…ë ¥ íŒŒë¼ë¯¸í„°ê¹Œì§€ í¬í•¨

2. **íˆ´ ì‹¤í–‰ ê²°ê³¼ë„ ì „ì†¡ë¨**
   - tool_result ì»¨í…ì¸  ë¸”ë¡
   - ì¶œë ¥, ì—ëŸ¬ ë©”ì‹œì§€
   - íŒŒì¼ ë‚´ìš© ë“±

3. **Request Body í¬ê¸°**
   - íˆ´ ì‚¬ìš©ì´ ë§ì„ìˆ˜ë¡ ì»¤ì§
   - Thinking ì¶”ì ë„ í¬í•¨
   - ìˆ˜ë°± KBê¹Œì§€ ê°€ëŠ¥

4. **í”„ë¼ì´ë²„ì‹œ ì˜í–¥**
   - íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡° ë…¸ì¶œ
   - ì½”ë“œ ë‚´ìš© ì „ì†¡
   - ëª…ë ¹ì–´ ì‹¤í–‰ ê¸°ë¡

### ë°ì´í„° íë¦„ ìš”ì•½

```
[CLAUDE CODE ë‚´ë¶€]
    íˆ´ ì‚¬ìš© ë°œìƒ
         â†“
[messages[].content[]]
    {type: "tool_use", name: "Bash", input: {...}}
         â†“
[API Request]
    POST /v1/messages
    Body: {messages: [...tool_use...]}
         â†“
[í”„ë¡ì‹œ ë¡œê·¸]
    ëª¨ë“  tool_useê°€ ê¸°ë¡ë¨
         â†“
[API ì„œë²„]
    íˆ´ ì‚¬ìš© ì •ë³´ ì²˜ë¦¬ ë° ì €ì¥
```

**ì‚¬ìš©ìê°€ ë³´ëŠ” `âº Bash(...)`, `âœï¸ Write(...)` ê°™ì€ ë¡œê·¸ë“¤ì€ ì‹¤ì œë¡œëŠ” API Request Bodyì˜ ì¼ë¶€ë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤!**
